# ASTRACAT_GUARD - Автоматическая защита "Из Коробки"

## Обзор

ASTRACAT_GUARD в автоматическом режиме представляет собой систему защиты, которая запускается и работает без каких-либо настроек со стороны пользователя. Система самостоятельно:

- Обнаруживает запущенные веб-серверы (Caddy, Nginx, Apache)
- Определяет файлы логов
- Автоматически настраивает пороги защиты
- Блокирует аномальный трафик
- Адаптируется к нагрузке сайта

## Установка

### Установка зависимостей
```bash
pip install psutil netifaces netaddr
```

### Запуск автоматической защиты
```bash
python3 /opt/astracat_guard/lib/automatic_guard.py
```

Или через CLI:
```bash
astracat-guard-auto start
```

## Автоматические функции

### 1. Автообнаружение сервисов
Система автоматически находит:
- Caddy, Nginx, Apache
- Активные сетевые порты
- Файлы логов

### 2. Автонастройка порогов
Система анализирует трафик и:
- Устанавливает динамические пороги
- Адаптирует чувствительность
- Оптимизирует защиту под нагрузку

### 3. Автоматические блокировки
- Блокировка аномального трафика
- Защита от DDoS
- Препятствие брутфорсу

## Docker автоматическая интеграция

### Запуск с Caddy
```bash
docker-compose -f auto-compose.yml up -d
```

Система автоматически:
- Обнаружит Caddy в сети Docker
- Подключится к его логам
- Начнет защиту без настроек

### Docker Compose особенности
- Использует volume для доступа к логам
- Применяет необходимые capabilities
- Работает в автоматическом режиме

## Мониторинг

### Проверка статуса
```bash
astracat-guard-auto status
```

### Просмотр статистики
```bash
astracat-guard-auto stats
```

### Логи
Основные логи: `/var/log/astracat_guard_auto.log`

## Фазы работы

### 1. Фаза обучения (5 минут)
- Система анализирует нормальный трафик
- Учиться определять шаблоны
- Не применяет блокировок

### 2. Фаза активной защиты
- Применение автоматически рассчитанных порогов
- Блокировка подозрительного трафика
- Непрерывная адаптация

## Особенности автоматического режима

1. **Нет конфигурационных файлов** - всё определяется автоматически
2. **Самообучающаяся система** - пороги адаптируются под нагрузку
3. **Минимальные ресурсы** - оптимизированный код
4. **Интеграция с Caddy "из коробки"** - автоматическое обнаружение

## Установка как системного сервиса

```bash
astracat-guard-auto install-auto
sudo systemctl daemon-reload
sudo systemctl enable astracat-guard-auto
sudo systemctl start astracat-guard-auto
```

## Безопасность

### Docker безопасность
- Используются capabilities вместо privileged
- Минимизация прав доступа
- Изоляция контейнеров

### Сетевая безопасность
- Работа через iptables
- Автоматические правила блокировки
- Безопасное взаимодействие с системой

## Устранение неполадок

### Система не запускается
Проверьте зависимости:
```bash
pip install psutil netifaces netaddr
```

### Не обнаруживаются логи Caddy
Убедитесь, что Caddy настроен на JSON логирование или используется общий volume.

### Высокое потребление ресурсов
Автоматическая система оптимизирована для минимального потребления, но может использовать больше ресурсов во время фазы обучения.

## Принципы работы

1. **Обнаружение** - Сканирование системы на наличие сервисов
2. **Анализ** - Изучение шаблонов трафика
3. **Адаптация** - Установка оптимальных порогов
4. **Защита** - Блокировка аномального трафика
5. **Обновление** - Постоянная адаптация к изменениям

Система полностью автономна и не требует вмешательства администратора после запуска!